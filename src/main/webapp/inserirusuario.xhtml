<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:jsf="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:p="http://primefaces.org/ui" lang="en">

<h:head>
<title>Cadastro de Usuários</title>
<script type="text/javascript">
		function confirmarExclusao(nome) {
			return window.confirm("Deseja excluir o " + nome + "?");
		}
	</script>
</h:head>
<h:body>
	<h3>Cadastro de Usuários</h3>
	<h:form id="form-cadastro" prependId="false">
		<p:outputLabel value="Perfil" />
		<p:selectOneMenu id="perfil" 
			value="#{usuarioController.usuario.perfil}"
			converter="#{perfilConverter}">
			<f:selectItem itemValue="" itemLabel="Sem Perfil"/>
			<f:selectItems value="#{perfilController.perfis}"
				var="perfil" itemLabel="#{perfil.descricao}"/>
		</p:selectOneMenu>
		<p:outputLabel for="nome" value="Nome:" />
		<p:inputText id="nome" value="#{usuarioController.usuario.nome}"
			placeholder="Digite o nome" />
		<p:focus for="nome" />

		<p:outputLabel for="login" value="Login:" />
		<p:inputText id="login" disabled="#{usuarioController.edicao}"
			value="#{usuarioController.usuario.login}"
			placeholder="Digite o login" />

		<p:outputLabel for="senha" rendered="#{!usuarioController.edicao}"
			value="Senha:" />
		<p:password id="senha" 
			value="#{usuarioController.usuario.senha}"
			rendered="#{!usuarioController.edicao}"
			placeholder="Digite a senha" />

		<p:commandButton
			actionListener="#{usuarioController.prepararInclusao()}" value="Novo"
			update="@form" />
		<p:commandButton actionListener="#{usuarioController.salvar()}"
			value="Salvar" update="@form" />

	</h:form>

	<p:messages />

	<h:form>
		<p:dataTable value="#{usuarioController.usuarios}" var="usuario">
			<p:column headerText="#">
				#{usuario.id}
			</p:column>
			<p:column headerText="Perfil">
				#{usuario.perfil.descricao}
			</p:column>
			<p:column headerText="Nome">
				#{usuario.nome}
			</p:column>
			<p:column headerText="Login">
				#{usuario.login}
			</p:column>
			<p:column headerText="Opções">
				<p:commandButton
					actionListener="#{usuarioController.prepararEdicao(usuario)}"
					value="Editar" update="form-cadastro" />
				<p:commandButton
					actionListener="#{usuarioController.excluir(usuario)}"
					value="Excluir" update="@form"
					onclick="return confirmarExclusao('#{usuario.nome}')" />
			</p:column>
		</p:dataTable>
	</h:form>
</h:body>
</html>